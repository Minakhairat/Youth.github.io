<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Ninety-Nine</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet" />
  <style>
    :root{
      --primary:#1b335f; --accent:#e5c558; --bg:#f9f9fb; --card:#fff; --text:#111; --muted:#6b7280;
      --ok:#16a34a; --warn:#ca8a04; --danger:#dc2626;
      --cover-h:220px;     /* ارتفاع الكفر المطلوب */
      --footer-h:46px;     /* ارتفاع الفوتر الثابت */
      --cover-border:#00000014;
      --cover-grad: linear-gradient(180deg, #00000055 0%, #00000022 50%, transparent 100%);
    }
    :root[data-theme="dark"]{
      --bg:#0f1115; --card:#161a22; --text:#e7e7ea; --muted:#9aa3b2;
      --cover-border:#ffffff14;
      --cover-grad: linear-gradient(180deg, #0b0f1acc 0%, #0b0f1a66 60%, transparent 100%);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:"Cairo", system-ui, sans-serif; background:var(--bg); color:var(--text);
      padding-bottom:var(--footer-h);
    }

    /* ===== الغلاف (Cover) بدون نص ===== */
    .cover{
      position:relative; width:100%; height:var(--cover-h);
      overflow:hidden; border-bottom:1px solid var(--cover-border); background:#000;
    }
    .cover__img{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; object-position:center;
      filter:saturate(1.05) contrast(1.05);
    }
    .cover__overlay{ position:absolute; inset:0; background:var(--cover-grad); pointer-events:none; }

    /* ===== الهيدر: الأفاتار فوق والعنوان تحته سطر واحد ===== */
    header{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:10px 16px; background:var(--card); border-bottom:1px solid #0002;
      position:sticky; top:0; z-index:10;
    }
    .brand{
      display:flex; flex-direction:column; align-items:center; gap:6px; text-align:center;
    }
    .logo{
      width:220px; height:80px; border-radius:16px;
      border:3px solid var(--accent); object-fit:cover; background:#fff;
      box-shadow:0 6px 16px #0003; animation:pop .6s ease;
    }
    .brand h1{
      margin:0; font-size:22px; font-weight:900; line-height:1;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      max-width:min(70vw,520px);  /* يخليها سطر واحد منسق */
    }

    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    /* قاعدة عامة موحّدة للأزرار */
    .btn,.btn-ghost,.btn-danger,.nav button{
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      height:44px;padding:0 16px;line-height:1;font-weight:800;cursor:pointer;
      border-radius:9999px;border:1px solid transparent;
      transition:transform .12s ease, box-shadow .2s ease, filter .2s ease;
    }
    /* أساسي */
    .btn{
      background:linear-gradient(180deg,#324b8a,var(--primary));
      color:#fff; box-shadow:0 6px 16px #0003, inset 0 -2px 0 #0003;
    }
    .btn:hover{ transform:translateY(-1px); box-shadow:0 10px 24px #0004; }
    .btn:active{ transform:none; }
    /* شفاف/ثانوي */
    .btn-ghost{
      background:var(--card); border-color:#0002; color:var(--text);
      box-shadow:0 2px 8px #0001;
    }
    .btn-ghost:hover{ transform:translateY(-1px); }
    /* خطير */
    .btn-danger{
      background:linear-gradient(180deg,#ef4444,#dc2626); color:#fff;
    }

    /* ===== النافبار ===== */
    .nav{display:flex;gap:12px;justify-content:center;margin:12px;flex-wrap:wrap}
    .nav button{
      background:var(--card); color:var(--text); border:1px solid #0002;
      padding:0 14px; height:40px; box-shadow:0 2px 8px #0001;
      cursor:pointer; font-weight:800; border-radius:9999px;
      transition:transform .15s, box-shadow .2s;
    }
    .nav button:hover{ transform: translateY(-1px); box-shadow:0 8px 18px #0002 }
    .nav button.active{background:var(--primary);color:#fff;border-color:transparent}

    /* ===== بطاقات وجداول ===== */
    .container{padding:16px;max-width:1200px;margin:auto}
    .card{background:var(--card);border:1px solid #0002;border-radius:16px;overflow:hidden; animation: fadeUp .5s ease var(--i,0ms) both}
    .card-h{padding:14px 20px;font-weight:900;background:linear-gradient(90deg,var(--primary),#7a93d6); color:#fff}
    .card-h small{opacity:.85;font-weight:700}
    .card-h .right{float:inline-end}
    .card-h .right>*{vertical-align:middle}
    .card-h .right .btn-ghost{background:transparent;border-color:#ffffff55;color:#fff}
    .card-h .right .btn-ghost:hover{filter:brightness(1.05)}
    .card-h .title{
      font-size:18px; display:inline-flex; gap:8px; align-items:center;
      background:linear-gradient(90deg, #fff, #f5f7ff); -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    }
    .card-h::before{content:'';display:block;height:3px;background:linear-gradient(90deg,transparent,var(--accent),transparent)}
    .card-b{padding:16px}
    .input{padding:10px;border:1px solid #0002;border-radius:10px;background:var(--card);color:var(--text);height:44px}
    .hint{color:var(--muted);font-size:13px}

    .table-wrap{border:1px solid #0002;border-radius:12px;overflow:auto;max-height:60vh}
    table{width:100%;border-collapse:separate;border-spacing:0;min-width:920px;color:var(--text)}
    th,td{padding:12px;text-align:start;border-bottom:1px solid #0002}
    thead th{background:#f3f4f6;color:#111;position:sticky;top:0;z-index:1}
    [data-theme="dark"] thead th{background:#1f2635;color:#e7e7ea}
    tbody tr:nth-child(odd){background:#fafafa}
    [data-theme="dark"] tbody tr:nth-child(odd){background:#121a2a}
    tbody tr:hover{background:#f0f0f0}
    [data-theme="dark"] tbody tr:hover{background:#0f1726}
    img.avatar{width:44px;height:44px;border-radius:10px;object-fit:cover;border:2px solid var(--accent)}
    a.tel{color:inherit;text-decoration:underline dotted}

    .stats-bar{display:flex;gap:10px;flex-wrap:wrap;margin:8px 0}
    .stat{
      display:flex;align-items:center;gap:8px;background:var(--card);border:1px solid #0002;border-radius:12px;
      padding:10px 12px;font-weight:900;color:var(--text)
    }
    .stat i{font-style:normal;opacity:.75}

    .error{background:#fee2e2;color:#7f1d1d;border:1px solid #fecaca;padding:12px;border-radius:10px}

    /* ===== التوستات ===== */
    .toast-area{position:fixed;bottom:calc(var(--footer-h) + 8px);left:50%;transform:translateX(-50%);display:flex;flex-direction:column;gap:8px;z-index:50}
    .toast{background:var(--card);color:var(--text);border:1px solid #0002;border-radius:12px;padding:10px 12px;box-shadow:0 6px 20px #0004;min-width:240px;transition:opacity .3s}
    .toast.ok{border-color:var(--ok)} .toast.warn{border-color:var(--warn)} .toast.err{border-color:var(--danger)}

    /* ===== فوتر ثابت ===== */
    footer.site-footer{
      position:fixed; inset-inline:0; bottom:0; height:var(--footer-h);
      display:flex; align-items:center; justify-content:center; gap:8px;
      padding:0 12px; background:var(--card); color:var(--muted);
      border-top:1px solid #0002; z-index:40; font-size:13px; text-align:center;
    }

    /* Animations */
    @keyframes fadeUp { from {opacity:0; transform:translateY(6px)} to {opacity:1; transform:none} }
    @keyframes pop { 0% {transform:scale(.92); opacity:0} 100% {transform:none; opacity:1} }
  </style>
</head>
<body>

  <!-- ===== الغلاف ===== -->
  <section class="cover">
    <img class="cover__img" id="coverImg" alt="غلاف الموقع">
    <div class="cover__overlay"></div>
  </section>

  <!-- ===== الهيدر (أفاتار فوق وعنوان تحته سطر واحد) ===== -->
  <header>
    <div class="brand">
      <img id="logoImg" class="logo" alt="شعار الخدمة">
      <h1>The Ninety-Nine</h1>
    </div>
    <div class="toolbar">
      <button id="themeBtn" class="btn-ghost">🌙 Dark</button>
      <button id="logoutBtn" class="btn-danger">خروج</button>
    </div>
  </header>

  <!-- ===== النافبار ===== -->
  <nav class="nav">
    <button class="active" data-tab="attendance">حضور ✅</button>
    <button data-tab="data">بيانات 👥</button>
    <button data-tab="login">دخول 🔐</button>
    <button data-tab="stats">إحصائيات 📊</button>
  </nav>

  <!-- ===== المحتوى ===== -->
  <section class="container">
    <!-- تبويب تسجيل الدخول -->
    <div class="card" data-panel="login" style="display:none" style="--i:0ms">
      <div class="card-h"><span class="title">تسجيل الدخول</span></div>
      <div class="card-b">
        <div class="hint">اكتب كلمة السر لفتح باقي الصفحات.</div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px">
          <input id="passInput" type="password" class="input" placeholder="كلمة السر">
          <button id="loginBtn" class="btn">دخول</button>
        </div>
      </div>
    </div>

    <!-- تبويب البيانات -->
    <div class="card" data-panel="data" style="--i:80ms">
      <div class="card-h">
        <span class="title">بيانات المخدومين 👥</span>
        <span class="right">
          <button id="exportAllBtn" class="btn-ghost">⬇️ تصدير CSV الكل</button>
        </span>
      </div>
      <div class="card-b">
        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
          <label>الأسرة:
            <select id="familyFilter">
              <option value="">الكل</option>
              <option>Family 1 Boys</option>
              <option>Family 2 Girls</option>
              <option>Family 3</option>
            </select>
          </label>
          <input id="searchInput" class="input" placeholder="ابحث... بالاسم/الموبايل/العنوان">
          <button id="refreshBtn" class="btn">تحديث ↻</button>
        </div>

        <div id="dataError" class="error" style="display:none"></div>
        <div class="stats-bar" id="topStats"></div>

        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>الاسم</th>
                <th>الأسرة</th>
                <th>الموبايل</th>
                <th>العنوان</th>
                <th>Fun Fact</th>
                <th>ملاحظات</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- تبويب الحضور -->
    <div class="card" data-panel="attendance" style="--i:160ms">
      <div class="card-h"><span class="title">تسجيل الحضور ✅</span></div>
      <div class="card-b">
        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
          <input id="nameInput" class="input" placeholder="الاسم">
          <input id="familyInput" class="input" placeholder="الأسرة">
          <button id="addBtn" class="btn">إضافة</button>
          <button id="clearBtn" class="btn-ghost">تفريغ</button>
        </div>
        <div id="list"></div>
      </div>
    </div>

    <!-- تبويب الإحصائيات -->
    <div class="card" data-panel="stats" style="display:none; --i:240ms">
      <div class="card-h"><span class="title">إحصائيات 📊</span></div>
      <div class="card-b">
        <p class="hint">هنا ملخص سريع…</p>
        <div id="statsBox"></div>
      </div>
    </div>
  </section>

  <!-- ===== الفوتر الثابت لحقوق النشر ===== -->
  <footer class="site-footer">
    جميع الحقوق محفوظة لخدمة شباب كنيسة العذراء مريم و البابا أثناسيوس الرسولي بمدينة نصر ©
  </footer>

  <script>
    // ثيم
    const root = document.documentElement;
    const themeBtn = document.getElementById('themeBtn');
    const prefersDark = matchMedia('(prefers-color-scheme: dark)').matches;
    if (prefersDark) root.setAttribute('data-theme','dark');
    themeBtn.addEventListener('click', () => {
      const isDark = root.getAttribute('data-theme') === 'dark';
      root.setAttribute('data-theme', isDark ? 'light' : 'dark');
      themeBtn.textContent = isDark ? '🌙 Dark' : '☀️ Light';
    });

    // صور الكفر واللوجو (بدون أي نص على الكفر)
    document.getElementById('coverImg').src = 'cover.jpg'; // عدّل المسار لو حابب
    document.getElementById('logoImg').src  = 'logo.jpg';  // عدّل المسار لو حابب

    // تبديل التبويبات
    const nav = document.querySelector('.nav');
    const panels = [...document.querySelectorAll('[data-panel]')];
    nav.addEventListener('click', (e)=>{
      if(e.target.tagName!=='BUTTON') return;
      nav.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
      e.target.classList.add('active');
      const tab = e.target.dataset.tab;
      panels.forEach(p => p.style.display = (p.dataset.panel===tab?'':'none'));
    });

    // أمثلة عمليات بسيطة
    const list = document.getElementById('list');
    document.getElementById('addBtn').onclick = ()=>{
      const name = (document.getElementById('nameInput').value||'').trim();
      const fam  = (document.getElementById('familyInput').value||'').trim();
      if(!name) return;
      const item = document.createElement('div');
      item.className = 'stat';
      item.innerHTML = `<b>${name}</b> <i>${fam||''}</i>`;
      list.prepend(item);
    };
    document.getElementById('clearBtn').onclick = ()=>{ list.innerHTML=''; };

    // زرار تحديث وهمي
    document.getElementById('refreshBtn').onclick = ()=>{
      const t = document.getElementById('topStats');
      t.innerHTML = '';
      [['المسجلين', 42], ['حضور اليوم', 18], ['غياب', 24]].forEach(([k,v])=>{
        const s = document.createElement('div'); s.className='stat'; s.innerHTML = `<b>${v}</b><i>${k}</i>`;
        t.appendChild(s);
      });
    };
  </script>
</body>
</html>
